<link rel="stylesheet" href="/css/chat_box.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">


<h1>Home Page</h1>

<section>
    
    <%if(locals.user) {%>
        <form action="/posts/create" id="new-post-form" method="post">
            <h4>POST</h4>
            <textarea name="content"  cols="30" rows="4" placeholder="Ask anything..." required></textarea>
            <input type="submit" value="submit">
        </form>
        <% } %>
    <div>
    <ul>
        <h4>All Post</h4>
        <%for(post of all_post) {%>
            <%- include('_post')-%>
        <% } %>
    </ul>
</div>

</section>


    <section>
        <%if(locals.user) {%>
        <div id="users-friends">
            <div class="all-users-friends">
                <h2>Following</h2>
                    <!--sendReq has friendships populated in it-->
                    <%for (allFriends of sendReq.friendships) {%>
                    <ul>       
                        <li>
                            <a href="/users/profile/<%=allFriends.id %>"><%= allFriends.name%></a>
                            <!--it will go to the friends controller to delete the friend-->
                            <form action="/friend/create-friend" method="post">
                                <input type="hidden" name="userId" value="<%=allFriends._id%>">
                                <button type="submit" class="fabutton">
                                    <i class="fa-regular fa-circle-xmark"></i>
                                </button>
                            </form>
                        </li>
                    </ul>
                    <%}%>
                </div>
            <%}%>
            
    <div>    
    <h4>All Users</h4>
        <ul>
            
        <%for(let user of all_users) {%>
            <li>
                <a href="/users/profile/<%=user.id%>"><%=user.name%></a>
            </li>
        </ul>
    <% } %>
    </div>

      
</section>
<section>
    <%-include('_chat_box')-%>
</section>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
<script src="/js/chat_engine.js"></script>

<%if(locals.user) {%>
    
<script>
    new ChatEngine("user-chat-box","<%=locals.user.email%>")
</script>
<%}%>